import{_ as n,o as s,c as a,b as t}from"./app-3bb1037e.js";const e="/assets/1699102920049-8dc038ae.png",p="/assets/1699102963985-073e4f94.png",l="/assets/1699102984860-f00617f1.png",c="/assets/1699103072886-108b20bb.png",i="/assets/1699103088277-c7c5a5e9.png",o={},u=t(`<p>改造“自动投递微服务”和“简历微服务”，删除OpenFeign 和 Ribbon，使用Dubbo RPC 和 Dubbo LB</p><p>首先，需要删除或者注释掉⽗⼯程中的热部署依赖</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--热部署--&gt;</span>
 <span class="token comment">&lt;!--&lt;dependency&gt;
 &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
 &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
 &lt;optional&gt;true&lt;/optional&gt;
 &lt;/dependency&gt;
--&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>7.3.1</strong> <strong>服务提供者⼯程改造</strong></p><p>提取dubbo服务接⼝⼯程，lagou-service-dubbo-api</p><ul><li>接口类</li></ul><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>package com.lagou.edu.service;
public interface ResumeService {
 Integer findDefaultResumeByUserId(Long userId);
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>改造提供者⼯程（简历微服务）</li></ul><p>pom文件添加spring cloud + dubbo整合的依赖，同时添加dubbo服务接口工程依赖</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--spring cloud alibaba dubbo 依赖--&gt;</span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starterdubbo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.csp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sentinel-apache-dubboadapter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
 <span class="token comment">&lt;!--dubbo 服务接⼝依赖--&gt;</span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.lagou.edu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lagou-service-dubbo-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>删除原有ResumeService接口，引⼊dubbo服务接⼝⼯程中的 ResumeService接口，适当调整代码，在service的实现类上添加dubbo的 @Service注解</p><p><img src="`+e+`" alt="1699102920049"></p><ul><li>application.yml或者bootstrap.yml配置⽂件中添加dubbo配置</li></ul><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">dubbo</span><span class="token punctuation">:</span>
 <span class="token key atrule">scan</span><span class="token punctuation">:</span>
 <span class="token comment"># dubbo 服务扫描基准包</span>
 <span class="token key atrule">base-packages</span><span class="token punctuation">:</span> com.lagou.edu.service.impl
 <span class="token key atrule">protocol</span><span class="token punctuation">:</span>
 <span class="token comment"># dubbo 协议</span>
 <span class="token key atrule">name</span><span class="token punctuation">:</span> dubbo
 <span class="token comment"># dubbo 协议端⼝（ -1 表示⾃增端⼝，从 20880 开始）</span>
 <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">-1</span>
 <span class="token key atrule">registry</span><span class="token punctuation">:</span>
 <span class="token comment"># 挂载到 Spring Cloud 的注册中⼼</span>
 <span class="token key atrule">address</span><span class="token punctuation">:</span> spring<span class="token punctuation">-</span>cloud<span class="token punctuation">:</span>//localhost
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>另外增加⼀项配置</p><p><img src="`+p+'" alt="1699102963985"></p><p>运⾏发布之后，会发现Nacos控制台已经有了服务注册信息,从元数据中可以看出,是dubbo注册上来的</p><p><img src="'+l+`" alt="1699102984860"></p><p><strong>7.3.2</strong> <strong>服务消费者⼯程改造</strong></p><p>接下来改造服务消费者⼯程—&gt;⾃动投递微服务</p><ul><li>pom.xml中删除OpenFeign相关内容</li><li>application.yml配置⽂件中删除和Feign、Ribbon相关的内容；代码中删除 Feign客户端内容；</li><li>pom.xml添加内容和服务提供者⼀样</li><li>application.yml配置⽂件中添加dubbo相关内容</li></ul><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">dubbo</span><span class="token punctuation">:</span>
 <span class="token key atrule">registry</span><span class="token punctuation">:</span>
 <span class="token comment"># 挂载到 Spring Cloud 注册中⼼</span>
 <span class="token key atrule">address</span><span class="token punctuation">:</span> spring<span class="token punctuation">-</span>cloud<span class="token punctuation">:</span>//localhost
 <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
 <span class="token comment"># 订阅服务提供⽅的应⽤列表，订阅多个服务提供者使⽤ &quot;,&quot; 连接</span>
 <span class="token key atrule">subscribed-services</span><span class="token punctuation">:</span> lagou<span class="token punctuation">-</span>service<span class="token punctuation">-</span>resume
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>同样，也配置下spring.main.allow-bean-definition-overriding=true</p><ul><li>Controller代码改造，其他不变</li></ul><p><img src="`+c+'" alt="1699103072886"></p><p><img src="'+i+'" alt="1699103088277"></p>',26),d=[u];function r(g,k){return s(),a("div",null,d)}const v=n(o,[["render",r],["__file","73.html.vue"]]);export{v as default};
